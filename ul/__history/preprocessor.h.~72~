//---------------------------------------------------------------------------

#ifndef _PREPROCESSOR_H_
#define _PREPROCESSOR_H_

#include <vcl.h>
#include <RegularExpressions.hpp>

#define INCLUDE_COUNT    ( 1024 )
#define PREPROCESS_COUNT ( 1024 )

class preprocessor
{
	private:
		AnsiString	  source;
		AnsiString	  result;
		AnsiString	  code;
		//TStringList * source;
		//TStringList * result;
		TStringList * error;
		TStringDynArray parsing_result;

		TRegEx 		* r_trigraphs[ 9 ];					// Замена триргафов ( их 9 штук )
		void g_1_init_replace_trigraph();
		void g_1_replace_trigraph();


		TStringList * file;							// 1 #include
		TRegEx 		* reg_include_local;
		TRegEx 		* reg_include_global;
		int parse_include_global();
		int parse_include_local();

		TRegEx 		* reg_comments_multi;           // 2 Комментарии
		void parse_comments_multi();
		TRegEx 		* reg_comments_single;
		void parse_comments_single();

        AnsiString dyn2str( TStringDynArray arr );


	public:
		preprocessor();
		void load_code( AnsiString source );
		int process( TStringList * error );
		AnsiString save_code();
		~preprocessor();
};

//---------------------------------------------------------------------------

#endif
